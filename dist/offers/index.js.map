{"version":3,"sources":["../../src/offers/index.ts","../../src/offers/api.ts","../../src/offers/validation.ts"],"sourcesContent":["// Offers module - submission API and validation\r\nexport * from './api';\r\nexport * from './validation';\r\n","// ============================================\r\n// OFFERS API\r\n// Submit offers to dealer\r\n// ============================================\r\n\r\nimport type { OfferSubmission, PaymentFrequency } from '../types';\r\n\r\nexport interface OfferApiConfig {\r\n  baseUrl: string; // e.g., 'https://demo.dealers.works' or Central API\r\n}\r\n\r\nexport interface OfferPayload {\r\n  first_name: string;\r\n  last_name: string;\r\n  email: string;\r\n  phone: string;\r\n  message: string;\r\n  vin: string;\r\n  dealer_id: string;\r\n  vehicle_id: string;\r\n  stock_number: string;\r\n  offer_type: 'cash' | 'finance';\r\n  buy_payment: {\r\n    selloffprice: number;\r\n    net_amount_to_finance: number;\r\n    requsted_discount: number;\r\n    downpayment: number;\r\n    borrow_cost: number;\r\n    payment_amount: number;\r\n    has_trade_in: string;\r\n    trade_in_value: number;\r\n    frequency: 'weekly' | 'bi-weekly' | 'monthly';\r\n    term: number;\r\n    rate: number;\r\n    has_taxes: number;\r\n    tax_amount: number;\r\n    credit_score: string;\r\n    doc_fee: number;\r\n  };\r\n  trade_in_id?: string;\r\n}\r\n\r\n/**\r\n * Convert PaymentFrequency to API format\r\n */\r\nfunction mapFrequency(freq: PaymentFrequency): 'weekly' | 'bi-weekly' | 'monthly' {\r\n  if (freq === 'biweekly') return 'bi-weekly';\r\n  return freq;\r\n}\r\n\r\n/**\r\n * Build offer payload from submission\r\n */\r\nexport function buildOfferPayload(\r\n  submission: OfferSubmission,\r\n  docFee: number = 0\r\n): OfferPayload {\r\n  return {\r\n    first_name: submission.firstName,\r\n    last_name: submission.lastName,\r\n    email: submission.email,\r\n    phone: submission.phone,\r\n    message: submission.message || '',\r\n    vin: submission.vin,\r\n    dealer_id: submission.dealerId,\r\n    vehicle_id: submission.vehicleId,\r\n    stock_number: submission.stockNumber,\r\n    offer_type: submission.offerType,\r\n    buy_payment: {\r\n      selloffprice: submission.salePrice,\r\n      net_amount_to_finance: submission.netAmount,\r\n      requsted_discount: submission.discountRequest,\r\n      downpayment: submission.downPayment,\r\n      borrow_cost: submission.borrowCost,\r\n      payment_amount: submission.payment?.amount || 0,\r\n      has_trade_in: submission.tradeIn ? '1' : '0',\r\n      trade_in_value: submission.tradeIn?.desiredAmount || 0,\r\n      frequency: submission.payment ? mapFrequency(submission.payment.frequency) : 'bi-weekly',\r\n      term: submission.payment?.term || 0,\r\n      rate: submission.payment?.rate || 0,\r\n      has_taxes: submission.includeTaxes ? 1 : 0,\r\n      tax_amount: submission.taxAmount,\r\n      credit_score: submission.creditScore,\r\n      doc_fee: docFee,\r\n    },\r\n    trade_in_id: submission.tradeIn?.id,\r\n  };\r\n}\r\n\r\n/**\r\n * Submit offer to API\r\n */\r\nexport async function submitOffer(\r\n  config: OfferApiConfig,\r\n  submission: OfferSubmission,\r\n  docFee: number = 0\r\n): Promise<{ success: boolean; id?: string; error?: string }> {\r\n  const payload = buildOfferPayload(submission, docFee);\r\n  \r\n  const response = await fetch(`${config.baseUrl}/api/offers`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify(payload),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    return { success: false, error: `Failed to submit offer: ${response.status}` };\r\n  }\r\n\r\n  const data = await response.json() as { success: boolean; id?: string };\r\n  return { success: true, id: data.id };\r\n}\r\n","// ============================================\r\n// OFFER VALIDATION\r\n// ============================================\r\n\r\nexport interface ValidationErrors {\r\n  firstName?: string;\r\n  lastName?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  general?: string;\r\n}\r\n\r\nexport interface CustomerInfo {\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  phone: string;\r\n}\r\n\r\n/**\r\n * Validate customer info for offer submission\r\n */\r\nexport function validateCustomerInfo(info: CustomerInfo): ValidationErrors {\r\n  const errors: ValidationErrors = {};\r\n\r\n  // First Name\r\n  if (!info.firstName?.trim()) {\r\n    errors.firstName = 'First name is required';\r\n  }\r\n\r\n  // Last Name\r\n  if (!info.lastName?.trim()) {\r\n    errors.lastName = 'Last name is required';\r\n  }\r\n\r\n  // Email\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  if (!info.email?.trim() || !emailRegex.test(info.email)) {\r\n    errors.email = 'Valid email is required';\r\n  }\r\n\r\n  // Phone\r\n  const phoneRegex = /^\\d{10,}$/;\r\n  const cleanPhone = info.phone?.replace(/\\D/g, '') || '';\r\n  if (!cleanPhone || !phoneRegex.test(cleanPhone)) {\r\n    errors.phone = 'Valid phone number is required';\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check if validation passed\r\n */\r\nexport function isValid(errors: ValidationErrors): boolean {\r\n  return Object.keys(errors).length === 0;\r\n}\r\n\r\n/**\r\n * Format phone number for display\r\n */\r\nexport function formatPhone(phone: string): string {\r\n  const cleaned = phone.replace(/\\D/g, '');\r\n  if (cleaned.length === 10) {\r\n    return `(${cleaned.slice(0, 3)}) ${cleaned.slice(3, 6)}-${cleaned.slice(6)}`;\r\n  }\r\n  return phone;\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AC6CA,SAAS,aAAa,MAA4D;AAChF,MAAI,SAAS,WAAY,QAAO;AAChC,SAAO;AACT;AAKO,SAAS,kBACd,YACA,SAAiB,GACH;AACd,SAAO;AAAA,IACL,YAAY,WAAW;AAAA,IACvB,WAAW,WAAW;AAAA,IACtB,OAAO,WAAW;AAAA,IAClB,OAAO,WAAW;AAAA,IAClB,SAAS,WAAW,WAAW;AAAA,IAC/B,KAAK,WAAW;AAAA,IAChB,WAAW,WAAW;AAAA,IACtB,YAAY,WAAW;AAAA,IACvB,cAAc,WAAW;AAAA,IACzB,YAAY,WAAW;AAAA,IACvB,aAAa;AAAA,MACX,cAAc,WAAW;AAAA,MACzB,uBAAuB,WAAW;AAAA,MAClC,mBAAmB,WAAW;AAAA,MAC9B,aAAa,WAAW;AAAA,MACxB,aAAa,WAAW;AAAA,MACxB,gBAAgB,WAAW,SAAS,UAAU;AAAA,MAC9C,cAAc,WAAW,UAAU,MAAM;AAAA,MACzC,gBAAgB,WAAW,SAAS,iBAAiB;AAAA,MACrD,WAAW,WAAW,UAAU,aAAa,WAAW,QAAQ,SAAS,IAAI;AAAA,MAC7E,MAAM,WAAW,SAAS,QAAQ;AAAA,MAClC,MAAM,WAAW,SAAS,QAAQ;AAAA,MAClC,WAAW,WAAW,eAAe,IAAI;AAAA,MACzC,YAAY,WAAW;AAAA,MACvB,cAAc,WAAW;AAAA,MACzB,SAAS;AAAA,IACX;AAAA,IACA,aAAa,WAAW,SAAS;AAAA,EACnC;AACF;AAKA,eAAsB,YACpB,QACA,YACA,SAAiB,GAC2C;AAC5D,QAAM,UAAU,kBAAkB,YAAY,MAAM;AAEpD,QAAM,WAAW,MAAM,MAAM,GAAG,OAAO,OAAO,eAAe;AAAA,IAC3D,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,gBAAgB;AAAA,IAClB;AAAA,IACA,MAAM,KAAK,UAAU,OAAO;AAAA,EAC9B,CAAC;AAED,MAAI,CAAC,SAAS,IAAI;AAChB,WAAO,EAAE,SAAS,OAAO,OAAO,2BAA2B,SAAS,MAAM,GAAG;AAAA,EAC/E;AAEA,QAAM,OAAO,MAAM,SAAS,KAAK;AACjC,SAAO,EAAE,SAAS,MAAM,IAAI,KAAK,GAAG;AACtC;;;AC3FO,SAAS,qBAAqB,MAAsC;AACzE,QAAM,SAA2B,CAAC;AAGlC,MAAI,CAAC,KAAK,WAAW,KAAK,GAAG;AAC3B,WAAO,YAAY;AAAA,EACrB;AAGA,MAAI,CAAC,KAAK,UAAU,KAAK,GAAG;AAC1B,WAAO,WAAW;AAAA,EACpB;AAGA,QAAM,aAAa;AACnB,MAAI,CAAC,KAAK,OAAO,KAAK,KAAK,CAAC,WAAW,KAAK,KAAK,KAAK,GAAG;AACvD,WAAO,QAAQ;AAAA,EACjB;AAGA,QAAM,aAAa;AACnB,QAAM,aAAa,KAAK,OAAO,QAAQ,OAAO,EAAE,KAAK;AACrD,MAAI,CAAC,cAAc,CAAC,WAAW,KAAK,UAAU,GAAG;AAC/C,WAAO,QAAQ;AAAA,EACjB;AAEA,SAAO;AACT;AAKO,SAAS,QAAQ,QAAmC;AACzD,SAAO,OAAO,KAAK,MAAM,EAAE,WAAW;AACxC;AAKO,SAAS,YAAY,OAAuB;AACjD,QAAM,UAAU,MAAM,QAAQ,OAAO,EAAE;AACvC,MAAI,QAAQ,WAAW,IAAI;AACzB,WAAO,IAAI,QAAQ,MAAM,GAAG,CAAC,CAAC,KAAK,QAAQ,MAAM,GAAG,CAAC,CAAC,IAAI,QAAQ,MAAM,CAAC,CAAC;AAAA,EAC5E;AACA,SAAO;AACT;","names":[]}