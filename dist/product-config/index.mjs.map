{"version":3,"sources":["../../src/product-config/index.ts"],"sourcesContent":["// ============================================\r\n// PRODUCT CONFIG\r\n// Per-product, per-dealer configuration\r\n// ============================================\r\n\r\nexport interface EcommWidgetConfig {\r\n  profit_span: number;        // % of profit margin allowed as discount (new vehicles with cost)\r\n  new_span: number;           // % of sale price allowed as discount (new vehicles)\r\n  used_span: number;          // % of sale price allowed as discount (used vehicles)\r\n  default_span: number;       // Fallback discount $ (new vehicles without cost)\r\n  incl_disc_span: boolean;    // Include discount in span calculation\r\n  tax_1: number;              // Tax rate 1 (e.g., GST 5%)\r\n  tax_2: number;              // Tax rate 2 (e.g., PST 7%)\r\n  widget_style: 'full' | 'compact' | 'minimal';\r\n  primary_color: string;      // Hex color for theming\r\n}\r\n\r\nexport interface ProductConfig<T = EcommWidgetConfig> {\r\n  _id?: string;\r\n  product_id: number;\r\n  product_slug: string;\r\n  dealer_id: string;\r\n  config: T;\r\n  created_at?: Date;\r\n  updated_at?: Date;\r\n}\r\n\r\ninterface SpanCalculationParams {\r\n  salePrice: number;\r\n  cost?: number;              // Only for new vehicles\r\n  condition: 'new' | 'used';\r\n  config: EcommWidgetConfig;\r\n}\r\n\r\n/**\r\n * Calculate max discount (span) for a vehicle based on product config\r\n * \r\n * Logic:\r\n * - New: salePrice * new_span%\r\n * - Used: salePrice * used_span%\r\n */\r\nexport function calculateMaxDiscountFromConfig(params: SpanCalculationParams): number {\r\n  const { salePrice, cost, condition, config } = params;\r\n  \r\n  let rawDiscount: number;\r\n  \r\n  if (condition === 'new') {\r\n    rawDiscount = salePrice * (config.new_span / 100);\r\n\r\n    // if (cost && cost > 0) {\r\n    //   // New with cost: % of profit margin\r\n    //   const profitMargin = salePrice - cost;\r\n    //   rawDiscount = profitMargin * (config.profit_span / 100);\r\n    // } else {\r\n    //   // New without cost: use default span\r\n    //   rawDiscount = config.default_span;\r\n    // }\r\n  } else {\r\n    // Used: % of sale price\r\n    rawDiscount = salePrice * (config.used_span / 100);\r\n  }\r\n  \r\n  // Round to nearest $100\r\n  return Math.round(rawDiscount / 100) * 100;\r\n}\r\n\r\n/**\r\n * Get total tax rate from config\r\n */\r\nexport function getTotalTaxRate(config: EcommWidgetConfig): number {\r\n  return config.tax_1 + config.tax_2;\r\n}\r\n"],"mappings":";AAyCO,SAAS,+BAA+B,QAAuC;AACpF,QAAM,EAAE,WAAW,MAAM,WAAW,OAAO,IAAI;AAE/C,MAAI;AAEJ,MAAI,cAAc,OAAO;AACvB,kBAAc,aAAa,OAAO,WAAW;AAAA,EAU/C,OAAO;AAEL,kBAAc,aAAa,OAAO,YAAY;AAAA,EAChD;AAGA,SAAO,KAAK,MAAM,cAAc,GAAG,IAAI;AACzC;AAKO,SAAS,gBAAgB,QAAmC;AACjE,SAAO,OAAO,QAAQ,OAAO;AAC/B;","names":[]}