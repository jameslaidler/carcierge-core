{"version":3,"sources":["../../src/doc-fees/index.ts"],"sourcesContent":["// ============================================\r\n// DOC FEE HANDLER\r\n// Filters and calculates applicable dealer fees\r\n// ============================================\r\n\r\nexport type VehicleCondition = 'new' | 'used';\r\nexport type DealType = 'finance' | 'cash' | 'lease';\r\n\r\nexport interface DocFee {\r\n  _id?: string;\r\n  dealer_id: string;\r\n  name: string;\r\n  description?: string;\r\n  value: number;\r\n  applies_new: boolean;\r\n  applies_used: boolean;\r\n  applies_finance: boolean;\r\n  applies_cash: boolean;\r\n  applies_lease: boolean;\r\n  is_active: boolean;\r\n  display_order?: number;\r\n}\r\n\r\nexport interface ApplicableFee {\r\n  name: string;\r\n  value: number;\r\n  description?: string;\r\n}\r\n\r\nexport interface DocFeeResult {\r\n  totalFee: number;\r\n  fees: ApplicableFee[];\r\n}\r\n\r\n/**\r\n * Get applicable doc fees for a deal\r\n */\r\nexport function getApplicableFees(\r\n  allFees: DocFee[],\r\n  condition: VehicleCondition,\r\n  dealType: DealType\r\n): DocFeeResult {\r\n  const applicableFees = allFees\r\n    .filter(fee => {\r\n      // Must be active\r\n      if (!fee.is_active) return false;\r\n      \r\n      // Check vehicle condition\r\n      const conditionMatch = condition === 'new' \r\n        ? fee.applies_new \r\n        : fee.applies_used;\r\n      if (!conditionMatch) return false;\r\n      \r\n      // Check deal type\r\n      const dealTypeMatch = \r\n        (dealType === 'finance' && fee.applies_finance) ||\r\n        (dealType === 'cash' && fee.applies_cash) ||\r\n        (dealType === 'lease' && fee.applies_lease);\r\n      if (!dealTypeMatch) return false;\r\n      \r\n      return true;\r\n    })\r\n    .sort((a, b) => (a.display_order ?? 0) - (b.display_order ?? 0));\r\n\r\n  const fees: ApplicableFee[] = applicableFees.map(fee => ({\r\n    name: fee.name,\r\n    value: fee.value,\r\n    description: fee.description,\r\n  }));\r\n\r\n  const totalFee = fees.reduce((sum, fee) => sum + fee.value, 0);\r\n\r\n  return { totalFee, fees };\r\n}\r\n\r\n/**\r\n * Quick helper to just get total fee amount\r\n */\r\nexport function getTotalDocFee(\r\n  allFees: DocFee[],\r\n  condition: VehicleCondition,\r\n  dealType: DealType\r\n): number {\r\n  return getApplicableFees(allFees, condition, dealType).totalFee;\r\n}\r\n"],"mappings":";AAqCO,SAAS,kBACd,SACA,WACA,UACc;AACd,QAAM,iBAAiB,QACpB,OAAO,SAAO;AAEb,QAAI,CAAC,IAAI,UAAW,QAAO;AAG3B,UAAM,iBAAiB,cAAc,QACjC,IAAI,cACJ,IAAI;AACR,QAAI,CAAC,eAAgB,QAAO;AAG5B,UAAM,gBACH,aAAa,aAAa,IAAI,mBAC9B,aAAa,UAAU,IAAI,gBAC3B,aAAa,WAAW,IAAI;AAC/B,QAAI,CAAC,cAAe,QAAO;AAE3B,WAAO;AAAA,EACT,CAAC,EACA,KAAK,CAAC,GAAG,OAAO,EAAE,iBAAiB,MAAM,EAAE,iBAAiB,EAAE;AAEjE,QAAM,OAAwB,eAAe,IAAI,UAAQ;AAAA,IACvD,MAAM,IAAI;AAAA,IACV,OAAO,IAAI;AAAA,IACX,aAAa,IAAI;AAAA,EACnB,EAAE;AAEF,QAAM,WAAW,KAAK,OAAO,CAAC,KAAK,QAAQ,MAAM,IAAI,OAAO,CAAC;AAE7D,SAAO,EAAE,UAAU,KAAK;AAC1B;AAKO,SAAS,eACd,SACA,WACA,UACQ;AACR,SAAO,kBAAkB,SAAS,WAAW,QAAQ,EAAE;AACzD;","names":[]}