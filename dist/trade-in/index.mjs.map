{"version":3,"sources":["../../src/trade-in/api.ts","../../src/trade-in/calculations.ts"],"sourcesContent":["// ============================================\r\n// TRADE-IN API CALLS\r\n// Calls to Central Vehicles API\r\n// ============================================\r\n\r\nimport type { Make, Model, TradeInVehicle, TradeInValuation } from '../types';\r\n\r\nconst DEFAULT_CENTRAL_API_URL = 'https://central-vehicles-node.vercel.app';\r\nconst DEFAULT_TRADE_IN_MARGIN = 0.15; // 15% dealer margin\r\n\r\nexport interface TradeInApiConfig {\r\n  baseUrl?: string;\r\n  apiKey: string;\r\n  tradeInMargin?: number;\r\n}\r\n\r\n// ============================================\r\n// FETCH MAKES\r\n// ============================================\r\n\r\nexport async function fetchMakes(config: TradeInApiConfig): Promise<Make[]> {\r\n  const baseUrl = config.baseUrl || DEFAULT_CENTRAL_API_URL;\r\n  \r\n  const response = await fetch(`${baseUrl}/api/makes`, {\r\n    headers: {\r\n      'X-API-Key': config.apiKey,\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch makes: ${response.status}`);\r\n  }\r\n\r\n  return response.json() as Promise<Make[]>;\r\n}\r\n\r\n// ============================================\r\n// FETCH MODELS\r\n// ============================================\r\n\r\nexport async function fetchModels(\r\n  config: TradeInApiConfig,\r\n  year: number,\r\n  makeId: number\r\n): Promise<Model[]> {\r\n  const baseUrl = config.baseUrl || DEFAULT_CENTRAL_API_URL;\r\n  \r\n  const response = await fetch(\r\n    `${baseUrl}/api/models?model_year=${year}&make_id=${makeId}`,\r\n    {\r\n      headers: {\r\n        'X-API-Key': config.apiKey,\r\n      },\r\n    }\r\n  );\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch models: ${response.status}`);\r\n  }\r\n\r\n  return response.json() as Promise<Model[]>;\r\n}\r\n\r\n// ============================================\r\n// GET VALUATION\r\n// ============================================\r\n\r\nexport async function getValuation(\r\n  config: TradeInApiConfig,\r\n  vehicle: TradeInVehicle\r\n): Promise<TradeInValuation> {\r\n  const baseUrl = config.baseUrl || DEFAULT_CENTRAL_API_URL;\r\n  const margin = config.tradeInMargin ?? DEFAULT_TRADE_IN_MARGIN;\r\n  \r\n  const response = await fetch(`${baseUrl}/api/trade-in`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-API-Key': config.apiKey,\r\n    },\r\n    body: JSON.stringify({\r\n      year: vehicle.year,\r\n      make: vehicle.make,\r\n      model: vehicle.model,\r\n      trim: vehicle.trim || 'Base',\r\n      mileage: vehicle.mileage,\r\n    }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to get valuation: ${response.status}`);\r\n  }\r\n\r\n  const data = await response.json() as { asking_price: number };\r\n  const askingPrice = data.asking_price;\r\n  const ourValue = Math.round(askingPrice * (1 - margin));\r\n\r\n  return {\r\n    askingPrice,\r\n    ourValue,\r\n    vehicle,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// GENERATE YEARS\r\n// ============================================\r\n\r\nexport function generateYears(startYear: number = 2000): number[] {\r\n  const currentYear = new Date().getFullYear();\r\n  return Array.from(\r\n    { length: currentYear - startYear + 1 }, \r\n    (_, i) => currentYear - i\r\n  );\r\n}\r\n","// ============================================\r\n// TRADE-IN CALCULATIONS\r\n// ============================================\r\n\r\nimport type { TradeInSubmission } from '../types';\r\n\r\n/**\r\n * Calculate net trade value (trade-in minus lien)\r\n */\r\nexport function calculateNetTradeValue(tradeInValue: number, lien: number): number {\r\n  return Math.max(0, tradeInValue - (lien || 0));\r\n}\r\n\r\n/**\r\n * Calculate net trade value from a submission\r\n */\r\nexport function getNetTradeFromSubmission(submission: TradeInSubmission): number {\r\n  return calculateNetTradeValue(submission.desiredAmount, submission.lien);\r\n}\r\n\r\n/**\r\n * Apply dealer margin to asking price\r\n */\r\nexport function applyDealerMargin(askingPrice: number, margin: number = 0.15): number {\r\n  return Math.round(askingPrice * (1 - margin));\r\n}\r\n"],"mappings":";AAOA,IAAM,0BAA0B;AAChC,IAAM,0BAA0B;AAYhC,eAAsB,WAAW,QAA2C;AAC1E,QAAM,UAAU,OAAO,WAAW;AAElC,QAAM,WAAW,MAAM,MAAM,GAAG,OAAO,cAAc;AAAA,IACnD,SAAS;AAAA,MACP,aAAa,OAAO;AAAA,IACtB;AAAA,EACF,CAAC;AAED,MAAI,CAAC,SAAS,IAAI;AAChB,UAAM,IAAI,MAAM,0BAA0B,SAAS,MAAM,EAAE;AAAA,EAC7D;AAEA,SAAO,SAAS,KAAK;AACvB;AAMA,eAAsB,YACpB,QACA,MACA,QACkB;AAClB,QAAM,UAAU,OAAO,WAAW;AAElC,QAAM,WAAW,MAAM;AAAA,IACrB,GAAG,OAAO,0BAA0B,IAAI,YAAY,MAAM;AAAA,IAC1D;AAAA,MACE,SAAS;AAAA,QACP,aAAa,OAAO;AAAA,MACtB;AAAA,IACF;AAAA,EACF;AAEA,MAAI,CAAC,SAAS,IAAI;AAChB,UAAM,IAAI,MAAM,2BAA2B,SAAS,MAAM,EAAE;AAAA,EAC9D;AAEA,SAAO,SAAS,KAAK;AACvB;AAMA,eAAsB,aACpB,QACA,SAC2B;AAC3B,QAAM,UAAU,OAAO,WAAW;AAClC,QAAM,SAAS,OAAO,iBAAiB;AAEvC,QAAM,WAAW,MAAM,MAAM,GAAG,OAAO,iBAAiB;AAAA,IACtD,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,gBAAgB;AAAA,MAChB,aAAa,OAAO;AAAA,IACtB;AAAA,IACA,MAAM,KAAK,UAAU;AAAA,MACnB,MAAM,QAAQ;AAAA,MACd,MAAM,QAAQ;AAAA,MACd,OAAO,QAAQ;AAAA,MACf,MAAM,QAAQ,QAAQ;AAAA,MACtB,SAAS,QAAQ;AAAA,IACnB,CAAC;AAAA,EACH,CAAC;AAED,MAAI,CAAC,SAAS,IAAI;AAChB,UAAM,IAAI,MAAM,4BAA4B,SAAS,MAAM,EAAE;AAAA,EAC/D;AAEA,QAAM,OAAO,MAAM,SAAS,KAAK;AACjC,QAAM,cAAc,KAAK;AACzB,QAAM,WAAW,KAAK,MAAM,eAAe,IAAI,OAAO;AAEtD,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AAMO,SAAS,cAAc,YAAoB,KAAgB;AAChE,QAAM,eAAc,oBAAI,KAAK,GAAE,YAAY;AAC3C,SAAO,MAAM;AAAA,IACX,EAAE,QAAQ,cAAc,YAAY,EAAE;AAAA,IACtC,CAAC,GAAG,MAAM,cAAc;AAAA,EAC1B;AACF;;;ACzGO,SAAS,uBAAuB,cAAsB,MAAsB;AACjF,SAAO,KAAK,IAAI,GAAG,gBAAgB,QAAQ,EAAE;AAC/C;AAKO,SAAS,0BAA0B,YAAuC;AAC/E,SAAO,uBAAuB,WAAW,eAAe,WAAW,IAAI;AACzE;AAKO,SAAS,kBAAkB,aAAqB,SAAiB,MAAc;AACpF,SAAO,KAAK,MAAM,eAAe,IAAI,OAAO;AAC9C;","names":[]}