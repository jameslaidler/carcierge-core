{"version":3,"sources":["../src/trade-in/api.ts","../src/trade-in/calculations.ts","../src/payments/calculations.ts","../src/payments/format.ts","../src/product-config/index.ts","../src/doc-fees/index.ts","../src/incentives/v1.ts","../src/offers/api.ts","../src/offers/validation.ts"],"sourcesContent":["// ============================================\r\n// TRADE-IN API CALLS\r\n// Calls to Central Vehicles API\r\n// ============================================\r\n\r\nimport type { Make, Model, TradeInVehicle, TradeInValuation } from '../types';\r\n\r\nconst DEFAULT_CENTRAL_API_URL = 'https://central-vehicles-node.vercel.app';\r\nconst DEFAULT_TRADE_IN_MARGIN = 0.15; // 15% dealer margin\r\n\r\nexport interface TradeInApiConfig {\r\n  baseUrl?: string;\r\n  apiKey: string;\r\n  tradeInMargin?: number;\r\n}\r\n\r\n// ============================================\r\n// FETCH MAKES\r\n// ============================================\r\n\r\nexport async function fetchMakes(config: TradeInApiConfig): Promise<Make[]> {\r\n  const baseUrl = config.baseUrl || DEFAULT_CENTRAL_API_URL;\r\n  \r\n  const response = await fetch(`${baseUrl}/api/makes`, {\r\n    headers: {\r\n      'X-API-Key': config.apiKey,\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch makes: ${response.status}`);\r\n  }\r\n\r\n  return response.json() as Promise<Make[]>;\r\n}\r\n\r\n// ============================================\r\n// FETCH MODELS\r\n// ============================================\r\n\r\nexport async function fetchModels(\r\n  config: TradeInApiConfig,\r\n  year: number,\r\n  makeId: number\r\n): Promise<Model[]> {\r\n  const baseUrl = config.baseUrl || DEFAULT_CENTRAL_API_URL;\r\n  \r\n  const response = await fetch(\r\n    `${baseUrl}/api/models?model_year=${year}&make_id=${makeId}`,\r\n    {\r\n      headers: {\r\n        'X-API-Key': config.apiKey,\r\n      },\r\n    }\r\n  );\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch models: ${response.status}`);\r\n  }\r\n\r\n  return response.json() as Promise<Model[]>;\r\n}\r\n\r\n// ============================================\r\n// GET VALUATION\r\n// ============================================\r\n\r\nexport async function getValuation(\r\n  config: TradeInApiConfig,\r\n  vehicle: TradeInVehicle\r\n): Promise<TradeInValuation> {\r\n  const baseUrl = config.baseUrl || DEFAULT_CENTRAL_API_URL;\r\n  const margin = config.tradeInMargin ?? DEFAULT_TRADE_IN_MARGIN;\r\n  \r\n  const response = await fetch(`${baseUrl}/api/trade-in`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-API-Key': config.apiKey,\r\n    },\r\n    body: JSON.stringify({\r\n      year: vehicle.year,\r\n      make: vehicle.make,\r\n      model: vehicle.model,\r\n      trim: vehicle.trim || 'Base',\r\n      mileage: vehicle.mileage,\r\n    }),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to get valuation: ${response.status}`);\r\n  }\r\n\r\n  const data = await response.json() as { asking_price: number };\r\n  const askingPrice = data.asking_price;\r\n  const ourValue = Math.round(askingPrice * (1 - margin));\r\n\r\n  return {\r\n    askingPrice,\r\n    ourValue,\r\n    vehicle,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// GENERATE YEARS\r\n// ============================================\r\n\r\nexport function generateYears(startYear: number = 2000): number[] {\r\n  const currentYear = new Date().getFullYear();\r\n  return Array.from(\r\n    { length: currentYear - startYear + 1 }, \r\n    (_, i) => currentYear - i\r\n  );\r\n}\r\n","// ============================================\r\n// TRADE-IN CALCULATIONS\r\n// ============================================\r\n\r\nimport type { TradeInSubmission } from '../types';\r\n\r\n/**\r\n * Calculate net trade value (trade-in minus lien)\r\n */\r\nexport function calculateNetTradeValue(tradeInValue: number, lien: number): number {\r\n  return Math.max(0, tradeInValue - (lien || 0));\r\n}\r\n\r\n/**\r\n * Calculate net trade value from a submission\r\n */\r\nexport function getNetTradeFromSubmission(submission: TradeInSubmission): number {\r\n  return calculateNetTradeValue(submission.desiredAmount, submission.lien);\r\n}\r\n\r\n/**\r\n * Apply dealer margin to asking price\r\n */\r\nexport function applyDealerMargin(askingPrice: number, margin: number = 0.15): number {\r\n  return Math.round(askingPrice * (1 - margin));\r\n}\r\n","// ============================================\r\n// PAYMENT CALCULATIONS\r\n// Core math for automotive financing\r\n// ============================================\r\n\r\nimport type { \r\n  CreditScore, \r\n  InterestRate, \r\n  VehicleInfo, \r\n  PaymentConfig, \r\n  PaymentResult,\r\n  PaymentFrequency \r\n} from '../types';\r\n\r\nexport const MINIMUM_FINANCE_AMOUNT = 5000;\r\n\r\n// ============================================\r\n// RATE DETERMINATION\r\n// ============================================\r\n\r\ninterface RateInfo {\r\n  rate: number;\r\n  maxTerm: number;\r\n  isFinanceable: boolean;\r\n  effectiveRate: number;\r\n  effectiveTerm: number;\r\n}\r\n\r\nexport function determineRate(\r\n  creditScore: CreditScore,\r\n  vehicle: VehicleInfo,\r\n  interestRates: InterestRate[],\r\n  requestedTerm: number\r\n): RateInfo {\r\n  // Filter to matching score and mileage\r\n  const matchingRates = interestRates.filter(rate => \r\n    rate.score === creditScore &&\r\n    rate.year <= vehicle.year &&\r\n    (!rate.max_mileage || vehicle.mileage <= rate.max_mileage)\r\n  );\r\n\r\n  // Find the best match (highest year that's still <= vehicle year)\r\n  const applicableRate = matchingRates.reduce<InterestRate | null>(\r\n    (best, rate) => (!best || rate.year > best.year) ? rate : best,\r\n    null\r\n  );\r\n\r\n  const maxTerm = applicableRate?.max_term ?? requestedTerm;\r\n  const termIsAllowed = typeof applicableRate?.max_term === 'number'\r\n    ? requestedTerm <= applicableRate.max_term\r\n    : true;\r\n\r\n  const isFinanceable = !!applicableRate && termIsAllowed;\r\n\r\n  return {\r\n    rate: applicableRate?.rate ?? 5,\r\n    maxTerm,\r\n    isFinanceable,\r\n    effectiveRate: applicableRate?.rate ?? 5,\r\n    effectiveTerm: requestedTerm\r\n  };\r\n}\r\n\r\n// ============================================\r\n// TAX CALCULATION\r\n// ============================================\r\n\r\nexport function calculateTaxAmount(params: {\r\n  salePrice: number;\r\n  discountRequest: number;\r\n  tradeInValue: number;\r\n  tax1: number;\r\n  tax2: number;\r\n}): number {\r\n  const { salePrice, discountRequest, tradeInValue, tax1, tax2 } = params;\r\n  const priceAfterDiscount = salePrice - discountRequest;\r\n  const taxableAmount = Math.max(0, priceAfterDiscount - tradeInValue);\r\n  const totalTaxRate = (tax1 + tax2) / 100;\r\n  return taxableAmount * totalTaxRate;\r\n}\r\n\r\n// ============================================\r\n// TRADE VALUE\r\n// ============================================\r\n\r\nexport function calculateNetTradeValue(tradeInValue: number, lien: number): number {\r\n  return tradeInValue - (lien || 0);\r\n}\r\n\r\n// ============================================\r\n// MONTHLY PAYMENT (BASE)\r\n// ============================================\r\n\r\nfunction calculateBaseMonthlyPayment(\r\n  principal: number,\r\n  term: number,\r\n  annualRate: number\r\n): number {\r\n  if (annualRate === 0) {\r\n    return principal / term;\r\n  }\r\n\r\n  const monthlyRate = (annualRate / 100) / 12;\r\n  return principal * \r\n    (monthlyRate * Math.pow(1 + monthlyRate, term)) / \r\n    (Math.pow(1 + monthlyRate, term) - 1);\r\n}\r\n\r\n// ============================================\r\n// FREQUENCY CONVERSION\r\n// ============================================\r\n\r\nexport function convertToFrequency(monthlyAmount: number, frequency: PaymentFrequency): number {\r\n  switch (frequency) {\r\n    case 'weekly':\r\n      return monthlyAmount * 12 / 52;\r\n    case 'biweekly':\r\n      return monthlyAmount * 12 / 26;\r\n    case 'monthly':\r\n      return monthlyAmount;\r\n    default:\r\n      return monthlyAmount;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// TOTAL COST\r\n// ============================================\r\n\r\nfunction calculateTotalCost(params: {\r\n  payment: number;\r\n  frequency: PaymentFrequency;\r\n  term: number;\r\n  downPayment: number;\r\n}): number {\r\n  const { payment, frequency, term, downPayment } = params;\r\n  const numberOfPayments = frequency === 'weekly' ? term * 52/12 :\r\n                          frequency === 'biweekly' ? term * 26/12 : \r\n                          term;\r\n  return (payment * numberOfPayments) + downPayment;\r\n}\r\n\r\n// ============================================\r\n// BORROW COST (INTEREST PAID)\r\n// ============================================\r\n\r\nexport function calculateBorrowCost(\r\n  salePrice: number,\r\n  discountRequest: number,\r\n  downPayment: number,\r\n  tradeInValue: number,\r\n  term: number,\r\n  rate: number\r\n): number {\r\n  const principal = salePrice - discountRequest - downPayment - tradeInValue;\r\n  if (principal <= 0 || rate === 0) return 0;\r\n  \r\n  const monthlyRate = (rate / 100) / 12;\r\n  const totalPayments = term * monthlyRate * principal / (1 - Math.pow(1 + monthlyRate, -term));\r\n  return Math.max(0, totalPayments - principal);\r\n}\r\n\r\n// ============================================\r\n// MAIN PAYMENT CALCULATION\r\n// ============================================\r\n\r\nexport function calculatePayment(params: {\r\n  vehicle: VehicleInfo;\r\n  paymentConfig: PaymentConfig;\r\n  docFee: number;\r\n  tax1: number;\r\n  tax2: number;\r\n  interestRates?: InterestRate[];\r\n}): PaymentResult {\r\n  const { vehicle, paymentConfig, docFee, tax1, tax2, interestRates = [] } = params;\r\n  const includeTaxes = paymentConfig.includeTaxes ?? false;\r\n  \r\n  // Calculate net trade value\r\n  const netTradeValue = paymentConfig.tradeInValue ? \r\n    calculateNetTradeValue(paymentConfig.tradeInValue, paymentConfig.lien ?? 0) : \r\n    0;\r\n\r\n  // Base price with doc fee\r\n  const basePrice = vehicle.salePrice + docFee;\r\n\r\n  // Apply discount\r\n  const priceAfterDiscount = basePrice - (paymentConfig.discountRequest ?? 0);\r\n\r\n  // Apply net trade and down payment\r\n  const priceAfterTrade = Math.max(0, priceAfterDiscount - netTradeValue);\r\n  const priceAfterDown = priceAfterTrade - (paymentConfig.downPayment ?? 0);\r\n\r\n  // Calculate tax if needed\r\n  const taxAmount = includeTaxes ? \r\n    calculateTaxAmount({\r\n      salePrice: vehicle.salePrice,\r\n      discountRequest: paymentConfig.discountRequest ?? 0,\r\n      tradeInValue: paymentConfig.tradeInValue ?? 0,\r\n      tax1,\r\n      tax2\r\n    }) : 0;\r\n\r\n  // Final amounts\r\n  const priceBeforeTax = priceAfterDown;\r\n  const priceAfterTax = priceBeforeTax + taxAmount;\r\n  const amountFinanced = priceAfterTax;\r\n\r\n  // Get rate info\r\n  const rateInfo = determineRate(\r\n    paymentConfig.creditScore,\r\n    vehicle,\r\n    interestRates,\r\n    paymentConfig.term\r\n  );\r\n\r\n  if (!rateInfo.isFinanceable) {\r\n    return {\r\n      payment: null,\r\n      amountFinanced,\r\n      totalCost: 0,\r\n      taxAmount,\r\n      priceBeforeTax,\r\n      priceAfterTax,\r\n      isFinanceable: false,\r\n      effectiveRate: rateInfo.effectiveRate,\r\n      effectiveTerm: rateInfo.effectiveTerm,\r\n      borrowCost: 0,\r\n      term: paymentConfig.term\r\n    };\r\n  }\r\n\r\n  // Calculate monthly payment\r\n  const monthlyPayment = calculateBaseMonthlyPayment(\r\n    amountFinanced,\r\n    rateInfo.effectiveTerm,\r\n    rateInfo.effectiveRate\r\n  );\r\n\r\n  // Convert to selected frequency\r\n  const payment = monthlyPayment ? \r\n    convertToFrequency(monthlyPayment, paymentConfig.frequency) : \r\n    null;\r\n\r\n  // Calculate total cost\r\n  const totalCost = payment ? \r\n    calculateTotalCost({\r\n      payment,\r\n      frequency: paymentConfig.frequency,\r\n      term: rateInfo.effectiveTerm,\r\n      downPayment: paymentConfig.downPayment ?? 0\r\n    }) : 0;\r\n\r\n  // Calculate borrow cost\r\n  const borrowCost = calculateBorrowCost(\r\n    vehicle.salePrice,\r\n    paymentConfig.discountRequest ?? 0,\r\n    paymentConfig.downPayment ?? 0,\r\n    paymentConfig.tradeInValue ?? 0,\r\n    paymentConfig.term,\r\n    rateInfo.effectiveRate\r\n  );\r\n\r\n  return {\r\n    payment,\r\n    amountFinanced,\r\n    totalCost,\r\n    taxAmount,\r\n    priceBeforeTax,\r\n    priceAfterTax,\r\n    isFinanceable: rateInfo.isFinanceable,\r\n    effectiveRate: rateInfo.effectiveRate,\r\n    effectiveTerm: rateInfo.effectiveTerm,\r\n    borrowCost,\r\n    term: paymentConfig.term\r\n  };\r\n}\r\n\r\nexport function calculatePaymentWithAnnualRateOverride(params: {\r\n  vehicle: VehicleInfo;\r\n  paymentConfig: PaymentConfig;\r\n  docFee: number;\r\n  tax1: number;\r\n  tax2: number;\r\n  annualRate: number;\r\n}): PaymentResult {\r\n  const { vehicle, paymentConfig, docFee, tax1, tax2, annualRate } = params;\r\n  const includeTaxes = paymentConfig.includeTaxes ?? false;\r\n\r\n  // Calculate net trade value\r\n  const netTradeValue = paymentConfig.tradeInValue ?\r\n    calculateNetTradeValue(paymentConfig.tradeInValue, paymentConfig.lien ?? 0) :\r\n    0;\r\n\r\n  // Base price with doc fee\r\n  const basePrice = vehicle.salePrice + docFee;\r\n\r\n  // Apply discount\r\n  const priceAfterDiscount = basePrice - (paymentConfig.discountRequest ?? 0);\r\n\r\n  // Apply net trade and down payment\r\n  const priceAfterTrade = Math.max(0, priceAfterDiscount - netTradeValue);\r\n  const priceAfterDown = priceAfterTrade - (paymentConfig.downPayment ?? 0);\r\n\r\n  // Calculate tax if needed\r\n  const taxAmount = includeTaxes ?\r\n    calculateTaxAmount({\r\n      salePrice: vehicle.salePrice,\r\n      discountRequest: paymentConfig.discountRequest ?? 0,\r\n      tradeInValue: paymentConfig.tradeInValue ?? 0,\r\n      tax1,\r\n      tax2\r\n    }) : 0;\r\n\r\n  // Final amounts\r\n  const priceBeforeTax = priceAfterDown;\r\n  const priceAfterTax = priceBeforeTax + taxAmount;\r\n  const amountFinanced = priceAfterTax;\r\n\r\n  // Calculate monthly payment\r\n  const monthlyPayment = calculateBaseMonthlyPayment(\r\n    amountFinanced,\r\n    paymentConfig.term,\r\n    annualRate\r\n  );\r\n\r\n  // Convert to selected frequency\r\n  const payment = monthlyPayment ?\r\n    convertToFrequency(monthlyPayment, paymentConfig.frequency) :\r\n    null;\r\n\r\n  // Calculate total cost\r\n  const totalCost = payment ?\r\n    calculateTotalCost({\r\n      payment,\r\n      frequency: paymentConfig.frequency,\r\n      term: paymentConfig.term,\r\n      downPayment: paymentConfig.downPayment ?? 0\r\n    }) : 0;\r\n\r\n  // Calculate borrow cost\r\n  const borrowCost = calculateBorrowCost(\r\n    vehicle.salePrice,\r\n    paymentConfig.discountRequest ?? 0,\r\n    paymentConfig.downPayment ?? 0,\r\n    paymentConfig.tradeInValue ?? 0,\r\n    paymentConfig.term,\r\n    annualRate\r\n  );\r\n\r\n  return {\r\n    payment,\r\n    amountFinanced,\r\n    totalCost,\r\n    taxAmount,\r\n    priceBeforeTax,\r\n    priceAfterTax,\r\n    isFinanceable: true,\r\n    effectiveRate: annualRate,\r\n    effectiveTerm: paymentConfig.term,\r\n    borrowCost,\r\n    term: paymentConfig.term\r\n  };\r\n}\r\n\r\n// ============================================\r\n// CASH PRICE CALCULATION\r\n// ============================================\r\n\r\nexport function calculateCashPrice(params: {\r\n  vehicle: VehicleInfo;\r\n  paymentConfig: Partial<PaymentConfig>;\r\n  docFee: number;\r\n  tax1: number;\r\n  tax2: number;\r\n}): number {\r\n  const { vehicle, paymentConfig, docFee, tax1, tax2 } = params;\r\n  const includeTaxes = paymentConfig.includeTaxes ?? false;\r\n  \r\n  const netTradeValue = paymentConfig.tradeInValue ? \r\n    calculateNetTradeValue(paymentConfig.tradeInValue, paymentConfig.lien ?? 0) : \r\n    0;\r\n\r\n  const priceWithDocFee = vehicle.salePrice + docFee;\r\n  const priceAfterDiscount = priceWithDocFee - (paymentConfig.discountRequest ?? 0);\r\n  const priceAfterTradeIn = priceAfterDiscount - netTradeValue;\r\n  const priceAfterDown = priceAfterTradeIn - (paymentConfig.downPayment ?? 0);\r\n  \r\n  if (includeTaxes) {\r\n    const taxAmount = calculateTaxAmount({\r\n      salePrice: vehicle.salePrice,\r\n      discountRequest: paymentConfig.discountRequest ?? 0,\r\n      tradeInValue: paymentConfig.tradeInValue ?? 0,\r\n      tax1,\r\n      tax2\r\n    });\r\n    return priceAfterDown + taxAmount;\r\n  }\r\n  \r\n  return priceAfterDown;\r\n}\r\n\r\n// ============================================\r\n// MAX DISCOUNT\r\n// ============================================\r\n\r\nexport function calculateMaxDiscount(salePrice: number, spanPercentage: number = 0.1): number {\r\n  const rawDiscount = salePrice * spanPercentage;\r\n  return Math.round(rawDiscount / 100) * 100;\r\n}\r\n\r\n// ============================================\r\n// VEHICLE FINANCING HELPERS\r\n// ============================================\r\n\r\n/**\r\n * Get the maximum allowed term for a vehicle/credit combo\r\n */\r\nexport function getMaxTerm(\r\n  vehicle: VehicleInfo,\r\n  creditScore: CreditScore,\r\n  interestRates: InterestRate[]\r\n): number {\r\n  const rateInfo = determineRate(creditScore, vehicle, interestRates, 999);\r\n  return rateInfo.maxTerm;\r\n}\r\n\r\n/**\r\n * Get available term options for a vehicle/credit combo\r\n * Returns only terms that are <= the max allowed term\r\n */\r\nexport function getAvailableTerms(\r\n  vehicle: VehicleInfo,\r\n  creditScore: CreditScore,\r\n  interestRates: InterestRate[],\r\n  allTerms: number[] = [24, 36, 48, 60, 72, 84]\r\n): number[] {\r\n  const maxTerm = getMaxTerm(vehicle, creditScore, interestRates);\r\n  return allTerms.filter(term => term <= maxTerm);\r\n}\r\n\r\n/**\r\n * Check if a vehicle is financeable for a given credit score\r\n */\r\nexport function isVehicleFinanceable(\r\n  vehicle: VehicleInfo,\r\n  creditScore: CreditScore,\r\n  interestRates: InterestRate[]\r\n): boolean {\r\n  const rateInfo = determineRate(creditScore, vehicle, interestRates, 60);\r\n  return rateInfo.isFinanceable;\r\n}\r\n\r\n/**\r\n * Get the rate for a specific vehicle/credit/term combo\r\n */\r\nexport function getRateForVehicle(\r\n  vehicle: VehicleInfo,\r\n  creditScore: CreditScore,\r\n  interestRates: InterestRate[],\r\n  requestedTerm: number\r\n): { rate: number; effectiveTerm: number; isFinanceable: boolean } {\r\n  const rateInfo = determineRate(creditScore, vehicle, interestRates, requestedTerm);\r\n  return {\r\n    rate: rateInfo.effectiveRate,\r\n    effectiveTerm: rateInfo.effectiveTerm,\r\n    isFinanceable: rateInfo.isFinanceable\r\n  };\r\n}\r\n","// ============================================\r\n// FORMATTING UTILITIES\r\n// ============================================\r\n\r\nexport function formatCurrency(amount: number): string {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency: 'USD'\r\n  }).format(amount);\r\n}\r\n\r\nexport function formatWholeNumber(amount: number): string {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency: 'USD',\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0\r\n  }).format(amount);\r\n}\r\n\r\nexport function formatNumber(amount: number): string {\r\n  return new Intl.NumberFormat('en-US').format(amount);\r\n}\r\n\r\nexport function formatFrequencyLabel(frequency: string): string {\r\n  switch (frequency) {\r\n    case 'weekly': return 'Weekly';\r\n    case 'biweekly': return 'Bi-weekly';\r\n    case 'monthly': return 'Monthly';\r\n    default: return frequency;\r\n  }\r\n}\r\n\r\nexport function formatCreditLabel(score: string): string {\r\n  switch (score) {\r\n    case 'poor': return 'Poor';\r\n    case 'fair': return 'Fair';\r\n    case 'good': return 'Good';\r\n    case 'excellent': return 'Excellent';\r\n    default: return score;\r\n  }\r\n}\r\n","// ============================================\r\n// PRODUCT CONFIG\r\n// Per-product, per-dealer configuration\r\n// ============================================\r\n\r\nexport interface EcommWidgetConfig {\r\n  profit_span: number;        // % of profit margin allowed as discount (new vehicles with cost)\r\n  new_span: number;           // % of sale price allowed as discount (new vehicles)\r\n  used_span: number;          // % of sale price allowed as discount (used vehicles)\r\n  default_span: number;       // Fallback discount $ (new vehicles without cost)\r\n  incl_disc_span: boolean;    // Include discount in span calculation\r\n  tax_1: number;              // Tax rate 1 (e.g., GST 5%)\r\n  tax_2: number;              // Tax rate 2 (e.g., PST 7%)\r\n  widget_style: 'full' | 'compact' | 'minimal';\r\n  primary_color: string;      // Hex color for theming\r\n}\r\n\r\nexport interface ProductConfig<T = EcommWidgetConfig> {\r\n  _id?: string;\r\n  product_id: number;\r\n  product_slug: string;\r\n  dealer_id: string;\r\n  config: T;\r\n  created_at?: Date;\r\n  updated_at?: Date;\r\n}\r\n\r\ninterface SpanCalculationParams {\r\n  salePrice: number;\r\n  cost?: number;              // Only for new vehicles\r\n  condition: 'new' | 'used';\r\n  config: EcommWidgetConfig;\r\n}\r\n\r\n/**\r\n * Calculate max discount (span) for a vehicle based on product config\r\n * \r\n * Logic:\r\n * - New: salePrice * new_span%\r\n * - Used: salePrice * used_span%\r\n */\r\nexport function calculateMaxDiscountFromConfig(params: SpanCalculationParams): number {\r\n  const { salePrice, cost, condition, config } = params;\r\n  \r\n  let rawDiscount: number;\r\n  \r\n  if (condition === 'new') {\r\n    rawDiscount = salePrice * (config.new_span / 100);\r\n\r\n    // if (cost && cost > 0) {\r\n    //   // New with cost: % of profit margin\r\n    //   const profitMargin = salePrice - cost;\r\n    //   rawDiscount = profitMargin * (config.profit_span / 100);\r\n    // } else {\r\n    //   // New without cost: use default span\r\n    //   rawDiscount = config.default_span;\r\n    // }\r\n  } else {\r\n    // Used: % of sale price\r\n    rawDiscount = salePrice * (config.used_span / 100);\r\n  }\r\n  \r\n  // Round to nearest $100\r\n  return Math.round(rawDiscount / 100) * 100;\r\n}\r\n\r\n/**\r\n * Get total tax rate from config\r\n */\r\nexport function getTotalTaxRate(config: EcommWidgetConfig): number {\r\n  return config.tax_1 + config.tax_2;\r\n}\r\n","// ============================================\r\n// DOC FEE HANDLER\r\n// Filters and calculates applicable dealer fees\r\n// ============================================\r\n\r\nexport type VehicleCondition = 'new' | 'used';\r\nexport type DealType = 'finance' | 'cash' | 'lease';\r\n\r\nexport interface DocFee {\r\n  _id?: string;\r\n  dealer_id: string;\r\n  name: string;\r\n  description?: string;\r\n  value: number;\r\n  applies_new: boolean;\r\n  applies_used: boolean;\r\n  applies_finance: boolean;\r\n  applies_cash: boolean;\r\n  applies_lease: boolean;\r\n  is_active: boolean;\r\n  display_order?: number;\r\n}\r\n\r\nexport interface ApplicableFee {\r\n  name: string;\r\n  value: number;\r\n  description?: string;\r\n}\r\n\r\nexport interface DocFeeResult {\r\n  totalFee: number;\r\n  fees: ApplicableFee[];\r\n}\r\n\r\n/**\r\n * Get applicable doc fees for a deal\r\n */\r\nexport function getApplicableFees(\r\n  allFees: DocFee[],\r\n  condition: VehicleCondition,\r\n  dealType: DealType\r\n): DocFeeResult {\r\n  const applicableFees = allFees\r\n    .filter(fee => {\r\n      // Must be active\r\n      if (!fee.is_active) return false;\r\n      \r\n      // Check vehicle condition\r\n      const conditionMatch = condition === 'new' \r\n        ? fee.applies_new \r\n        : fee.applies_used;\r\n      if (!conditionMatch) return false;\r\n      \r\n      // Check deal type\r\n      const dealTypeMatch = \r\n        (dealType === 'finance' && fee.applies_finance) ||\r\n        (dealType === 'cash' && fee.applies_cash) ||\r\n        (dealType === 'lease' && fee.applies_lease);\r\n      if (!dealTypeMatch) return false;\r\n      \r\n      return true;\r\n    })\r\n    .sort((a, b) => (a.display_order ?? 0) - (b.display_order ?? 0));\r\n\r\n  const fees: ApplicableFee[] = applicableFees.map(fee => ({\r\n    name: fee.name,\r\n    value: fee.value,\r\n    description: fee.description,\r\n  }));\r\n\r\n  const totalFee = fees.reduce((sum, fee) => sum + fee.value, 0);\r\n\r\n  return { totalFee, fees };\r\n}\r\n\r\n/**\r\n * Quick helper to just get total fee amount\r\n */\r\nexport function getTotalDocFee(\r\n  allFees: DocFee[],\r\n  condition: VehicleCondition,\r\n  dealType: DealType\r\n): number {\r\n  return getApplicableFees(allFees, condition, dealType).totalFee;\r\n}\r\n","export type IncentiveDealModeV1 = 'finance';\r\n\r\nexport interface IncentiveEligibilityV1 {\r\n  required: boolean;\r\n  tag: string;\r\n}\r\n\r\nexport interface IncentivePathV1 {\r\n  pathId: string;\r\n  dealMode: 'cash' | 'finance' | 'lease';\r\n  label: string;\r\n}\r\n\r\nexport type IncentiveOfferTypeV1 = 'cash' | 'apr_table' | 'rate_reduction';\r\n\r\nexport interface IncentiveOfferV1 {\r\n  offerId: string;\r\n  pathId: string;\r\n  type: IncentiveOfferTypeV1;\r\n  selectors: {\r\n    trim?: string;\r\n  };\r\n  eligibility: IncentiveEligibilityV1;\r\n  benefit: Record<string, unknown>;\r\n  stacking: {\r\n    group: string;\r\n  };\r\n}\r\n\r\nexport interface IncentiveJsonDataV1 {\r\n  ymmId: string;\r\n  year: number;\r\n  make: string;\r\n  model: string;\r\n  effective: {\r\n    start: string;\r\n    end: string;\r\n  };\r\n  paths: IncentivePathV1[];\r\n  offers: IncentiveOfferV1[];\r\n  programSetId: string;\r\n}\r\n\r\nfunction isRecord(value: unknown): value is Record<string, unknown> {\r\n  return !!value && typeof value === 'object' && !Array.isArray(value);\r\n}\r\n\r\nfunction isIncentiveJsonDataV1(value: unknown): value is IncentiveJsonDataV1 {\r\n  if (!isRecord(value)) return false;\r\n\r\n  return (\r\n    typeof value.ymmId === 'string' &&\r\n    typeof value.year === 'number' &&\r\n    typeof value.make === 'string' &&\r\n    typeof value.model === 'string' &&\r\n    isRecord(value.effective) &&\r\n    typeof value.effective.start === 'string' &&\r\n    typeof value.effective.end === 'string' &&\r\n    Array.isArray(value.paths) &&\r\n    Array.isArray(value.offers) &&\r\n    typeof value.programSetId === 'string'\r\n  );\r\n}\r\n\r\nexport function extractIncentiveJsonDataV1OrThrow(payload: unknown): IncentiveJsonDataV1 {\r\n  const direct = payload;\r\n  if (isIncentiveJsonDataV1(direct)) {\r\n    return direct;\r\n  }\r\n\r\n  if (isRecord(payload) && isIncentiveJsonDataV1(payload.json_data)) {\r\n    return payload.json_data;\r\n  }\r\n\r\n  if (isRecord(payload) && Array.isArray(payload.data) && payload.data.length > 0) {\r\n    const first = payload.data[0];\r\n    if (isRecord(first) && isIncentiveJsonDataV1(first.json_data)) {\r\n      return first.json_data;\r\n    }\r\n  }\r\n\r\n  const hint = isRecord(payload) ? Object.keys(payload).slice(0, 10).join(',') : typeof payload;\r\n  throw new Error(`Unable to extract IncentiveJsonDataV1 from payload (${hint})`);\r\n}\r\n\r\nexport interface EvaluateFinanceIncentivesInputV1 {\r\n  jsonData: IncentiveJsonDataV1;\r\n  trim: string;\r\n  termMonths: number;\r\n  asOfDate: string;\r\n  selectedEligibilityTags?: string[];\r\n}\r\n\r\nexport interface IncentiveCashLineItemV1 {\r\n  offerId: string;\r\n  stackingGroup: string;\r\n  eligibilityTag: string;\r\n  amount: number;\r\n  currency: string;\r\n}\r\n\r\nexport interface IncentiveRateReductionLineItemV1 {\r\n  offerId: string;\r\n  stackingGroup: string;\r\n  eligibilityTag: string;\r\n  aprPoints: number;\r\n}\r\n\r\nexport interface EvaluatedFinanceIncentivesV1 {\r\n  public: {\r\n    aprForTermMonths: number;\r\n    financeCashTotal: number;\r\n    financeCash: IncentiveCashLineItemV1[];\r\n  };\r\n  conditionalAvailable: {\r\n    financeCash: IncentiveCashLineItemV1[];\r\n    rateReductions: IncentiveRateReductionLineItemV1[];\r\n  };\r\n  conditionalApplied: {\r\n    selectedEligibilityTags: string[];\r\n    aprForTermMonths: number;\r\n    financeCashTotal: number;\r\n    financeCash: IncentiveCashLineItemV1[];\r\n    rateReductions: IncentiveRateReductionLineItemV1[];\r\n  };\r\n}\r\n\r\nfunction parseIsoDateOrThrow(value: string, label: string): Date {\r\n  const d = new Date(value);\r\n  if (Number.isNaN(d.getTime())) {\r\n    throw new Error(`Invalid ${label}: ${value}`);\r\n  }\r\n  return d;\r\n}\r\n\r\nfunction groupByStackingGroupOrThrow<T extends { stackingGroup: string }>(\r\n  items: T[],\r\n  label: string\r\n): Map<string, T> {\r\n  const map = new Map<string, T>();\r\n  for (const item of items) {\r\n    const existing = map.get(item.stackingGroup);\r\n    if (existing) {\r\n      throw new Error(`Ambiguous stacking: multiple ${label} items in group '${item.stackingGroup}'`);\r\n    }\r\n    map.set(item.stackingGroup, item);\r\n  }\r\n  return map;\r\n}\r\n\r\nfunction getFinancePathIdOrThrow(paths: IncentivePathV1[]): string {\r\n  const financePaths = paths.filter(p => p.dealMode === 'finance');\r\n  if (financePaths.length !== 1) {\r\n    throw new Error(`Expected exactly 1 finance path, found ${financePaths.length}`);\r\n  }\r\n  return financePaths[0].pathId;\r\n}\r\n\r\nfunction getAprForTermOrThrow(offer: IncentiveOfferV1, termMonths: number): number {\r\n  if (offer.type !== 'apr_table') {\r\n    throw new Error('Expected apr_table offer');\r\n  }\r\n\r\n  const benefit = offer.benefit as { aprByTermMonths?: Record<string, unknown> };\r\n  const table = benefit.aprByTermMonths;\r\n  if (!table || typeof table !== 'object') {\r\n    throw new Error(`APR table missing for offer ${offer.offerId}`);\r\n  }\r\n\r\n  const value = table[String(termMonths)];\r\n  if (typeof value !== 'number') {\r\n    throw new Error(`APR missing for termMonths=${termMonths} on offer ${offer.offerId}`);\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\nfunction normalizeMatchKey(value: string): string {\r\n  return value\r\n    .trim()\r\n    .replace(/\\s+/g, ' ')\r\n    .toLowerCase();\r\n}\r\n\r\nfunction cashLineItemFromOfferOrThrow(offer: IncentiveOfferV1): IncentiveCashLineItemV1 {\r\n  if (offer.type !== 'cash') {\r\n    throw new Error('Expected cash offer');\r\n  }\r\n  const benefit = offer.benefit as { cash?: unknown; currency?: unknown };\r\n  if (typeof benefit.cash !== 'number') {\r\n    throw new Error(`Cash benefit missing/invalid for offer ${offer.offerId}`);\r\n  }\r\n  if (typeof benefit.currency !== 'string') {\r\n    throw new Error(`Cash currency missing/invalid for offer ${offer.offerId}`);\r\n  }\r\n\r\n  return {\r\n    offerId: offer.offerId,\r\n    stackingGroup: offer.stacking.group,\r\n    eligibilityTag: offer.eligibility.tag,\r\n    amount: benefit.cash,\r\n    currency: benefit.currency,\r\n  };\r\n}\r\n\r\nfunction rateReductionFromOfferOrThrow(offer: IncentiveOfferV1): IncentiveRateReductionLineItemV1 {\r\n  if (offer.type !== 'rate_reduction') {\r\n    throw new Error('Expected rate_reduction offer');\r\n  }\r\n  const benefit = offer.benefit as { rateReductionPercent?: unknown };\r\n  if (typeof benefit.rateReductionPercent !== 'number') {\r\n    throw new Error(`rateReductionPercent missing/invalid for offer ${offer.offerId}`);\r\n  }\r\n\r\n  return {\r\n    offerId: offer.offerId,\r\n    stackingGroup: offer.stacking.group,\r\n    eligibilityTag: offer.eligibility.tag,\r\n    aprPoints: benefit.rateReductionPercent,\r\n  };\r\n}\r\n\r\nexport function evaluateFinanceIncentivesV1(input: EvaluateFinanceIncentivesInputV1): EvaluatedFinanceIncentivesV1 {\r\n  const { jsonData, trim, termMonths, asOfDate, selectedEligibilityTags = [] } = input;\r\n\r\n  const asOf = parseIsoDateOrThrow(asOfDate, 'asOfDate');\r\n  const start = parseIsoDateOrThrow(jsonData.effective.start, 'effective.start');\r\n  const end = parseIsoDateOrThrow(jsonData.effective.end, 'effective.end');\r\n\r\n  if (asOf < start || asOf > end) {\r\n    throw new Error(`Incentives not effective for asOfDate=${asOfDate}`);\r\n  }\r\n\r\n  const financePathId = getFinancePathIdOrThrow(jsonData.paths);\r\n\r\n  const trimKey = normalizeMatchKey(trim);\r\n\r\n  const matchingOffers = jsonData.offers.filter(o =>\r\n    o.pathId === financePathId &&\r\n    normalizeMatchKey(o.selectors.trim ?? '') === trimKey\r\n  );\r\n\r\n  const publicOffers = matchingOffers.filter(o => !o.eligibility.required);\r\n  const conditionalOffers = matchingOffers.filter(o => o.eligibility.required);\r\n\r\n  const publicAprOffers = publicOffers.filter(o => o.type === 'apr_table');\r\n  if (publicAprOffers.length !== 1) {\r\n    throw new Error(`Expected exactly 1 public apr_table offer for trim='${trim}', found ${publicAprOffers.length}`);\r\n  }\r\n  const publicAprForTerm = getAprForTermOrThrow(publicAprOffers[0], termMonths);\r\n\r\n  const publicFinanceCash = publicOffers\r\n    .filter(o => o.type === 'cash')\r\n    .map(cashLineItemFromOfferOrThrow);\r\n\r\n  groupByStackingGroupOrThrow(publicFinanceCash, 'public cash');\r\n\r\n  const conditionalCash = conditionalOffers\r\n    .filter(o => o.type === 'cash')\r\n    .map(cashLineItemFromOfferOrThrow);\r\n\r\n  groupByStackingGroupOrThrow(conditionalCash, 'conditional cash');\r\n\r\n  const conditionalRateReductions = conditionalOffers\r\n    .filter(o => o.type === 'rate_reduction')\r\n    .map(rateReductionFromOfferOrThrow);\r\n\r\n  groupByStackingGroupOrThrow(conditionalRateReductions, 'conditional rate reduction');\r\n\r\n  const publicFinanceCashTotal = publicFinanceCash.reduce((sum, item) => sum + item.amount, 0);\r\n\r\n  const selectedSet = new Set(selectedEligibilityTags);\r\n  const appliedConditionalCash = conditionalCash.filter(i => selectedSet.has(i.eligibilityTag));\r\n  const appliedConditionalRateReductions = conditionalRateReductions.filter(i => selectedSet.has(i.eligibilityTag));\r\n\r\n  const appliedConditionalCashTotal = appliedConditionalCash.reduce((sum, item) => sum + item.amount, 0);\r\n  const appliedRateReductionTotal = appliedConditionalRateReductions.reduce((sum, item) => sum + item.aprPoints, 0);\r\n\r\n  const appliedAprForTerm = publicAprForTerm - appliedRateReductionTotal;\r\n  if (appliedAprForTerm < 0) {\r\n    throw new Error(`Computed APR is negative (${appliedAprForTerm}) after reductions`);\r\n  }\r\n\r\n  return {\r\n    public: {\r\n      aprForTermMonths: publicAprForTerm,\r\n      financeCashTotal: publicFinanceCashTotal,\r\n      financeCash: publicFinanceCash,\r\n    },\r\n    conditionalAvailable: {\r\n      financeCash: conditionalCash,\r\n      rateReductions: conditionalRateReductions,\r\n    },\r\n    conditionalApplied: {\r\n      selectedEligibilityTags: [...selectedEligibilityTags],\r\n      aprForTermMonths: appliedAprForTerm,\r\n      financeCashTotal: publicFinanceCashTotal + appliedConditionalCashTotal,\r\n      financeCash: [...publicFinanceCash, ...appliedConditionalCash],\r\n      rateReductions: appliedConditionalRateReductions,\r\n    },\r\n  };\r\n}\r\n","// ============================================\r\n// OFFERS API\r\n// Submit offers to dealer\r\n// ============================================\r\n\r\nimport type { OfferSubmission, PaymentFrequency } from '../types';\r\n\r\nexport interface OfferApiConfig {\r\n  baseUrl: string; // e.g., 'https://demo.dealers.works' or Central API\r\n}\r\n\r\nexport interface OfferPayload {\r\n  first_name: string;\r\n  last_name: string;\r\n  email: string;\r\n  phone: string;\r\n  message: string;\r\n  vin: string;\r\n  dealer_id: string;\r\n  vehicle_id: string;\r\n  stock_number: string;\r\n  offer_type: 'cash' | 'finance';\r\n  buy_payment: {\r\n    selloffprice: number;\r\n    net_amount_to_finance: number;\r\n    requsted_discount: number;\r\n    downpayment: number;\r\n    borrow_cost: number;\r\n    payment_amount: number;\r\n    has_trade_in: string;\r\n    trade_in_value: number;\r\n    frequency: 'weekly' | 'bi-weekly' | 'monthly';\r\n    term: number;\r\n    rate: number;\r\n    has_taxes: number;\r\n    tax_amount: number;\r\n    credit_score: string;\r\n    doc_fee: number;\r\n  };\r\n  trade_in_id?: string;\r\n}\r\n\r\n/**\r\n * Convert PaymentFrequency to API format\r\n */\r\nfunction mapFrequency(freq: PaymentFrequency): 'weekly' | 'bi-weekly' | 'monthly' {\r\n  if (freq === 'biweekly') return 'bi-weekly';\r\n  return freq;\r\n}\r\n\r\n/**\r\n * Build offer payload from submission\r\n */\r\nexport function buildOfferPayload(\r\n  submission: OfferSubmission,\r\n  docFee: number = 0\r\n): OfferPayload {\r\n  return {\r\n    first_name: submission.firstName,\r\n    last_name: submission.lastName,\r\n    email: submission.email,\r\n    phone: submission.phone,\r\n    message: submission.message || '',\r\n    vin: submission.vin,\r\n    dealer_id: submission.dealerId,\r\n    vehicle_id: submission.vehicleId,\r\n    stock_number: submission.stockNumber,\r\n    offer_type: submission.offerType,\r\n    buy_payment: {\r\n      selloffprice: submission.salePrice,\r\n      net_amount_to_finance: submission.netAmount,\r\n      requsted_discount: submission.discountRequest,\r\n      downpayment: submission.downPayment,\r\n      borrow_cost: submission.borrowCost,\r\n      payment_amount: submission.payment?.amount || 0,\r\n      has_trade_in: submission.tradeIn ? '1' : '0',\r\n      trade_in_value: submission.tradeIn?.desiredAmount || 0,\r\n      frequency: submission.payment ? mapFrequency(submission.payment.frequency) : 'bi-weekly',\r\n      term: submission.payment?.term || 0,\r\n      rate: submission.payment?.rate || 0,\r\n      has_taxes: submission.includeTaxes ? 1 : 0,\r\n      tax_amount: submission.taxAmount,\r\n      credit_score: submission.creditScore,\r\n      doc_fee: docFee,\r\n    },\r\n    trade_in_id: submission.tradeIn?.id,\r\n  };\r\n}\r\n\r\n/**\r\n * Submit offer to API\r\n */\r\nexport async function submitOffer(\r\n  config: OfferApiConfig,\r\n  submission: OfferSubmission,\r\n  docFee: number = 0\r\n): Promise<{ success: boolean; id?: string; error?: string }> {\r\n  const payload = buildOfferPayload(submission, docFee);\r\n  \r\n  const response = await fetch(`${config.baseUrl}/api/offers`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify(payload),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    return { success: false, error: `Failed to submit offer: ${response.status}` };\r\n  }\r\n\r\n  const data = await response.json() as { success: boolean; id?: string };\r\n  return { success: true, id: data.id };\r\n}\r\n","// ============================================\r\n// OFFER VALIDATION\r\n// ============================================\r\n\r\nexport interface ValidationErrors {\r\n  firstName?: string;\r\n  lastName?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  general?: string;\r\n}\r\n\r\nexport interface CustomerInfo {\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  phone: string;\r\n}\r\n\r\n/**\r\n * Validate customer info for offer submission\r\n */\r\nexport function validateCustomerInfo(info: CustomerInfo): ValidationErrors {\r\n  const errors: ValidationErrors = {};\r\n\r\n  // First Name\r\n  if (!info.firstName?.trim()) {\r\n    errors.firstName = 'First name is required';\r\n  }\r\n\r\n  // Last Name\r\n  if (!info.lastName?.trim()) {\r\n    errors.lastName = 'Last name is required';\r\n  }\r\n\r\n  // Email\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  if (!info.email?.trim() || !emailRegex.test(info.email)) {\r\n    errors.email = 'Valid email is required';\r\n  }\r\n\r\n  // Phone\r\n  const phoneRegex = /^\\d{10,}$/;\r\n  const cleanPhone = info.phone?.replace(/\\D/g, '') || '';\r\n  if (!cleanPhone || !phoneRegex.test(cleanPhone)) {\r\n    errors.phone = 'Valid phone number is required';\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check if validation passed\r\n */\r\nexport function isValid(errors: ValidationErrors): boolean {\r\n  return Object.keys(errors).length === 0;\r\n}\r\n\r\n/**\r\n * Format phone number for display\r\n */\r\nexport function formatPhone(phone: string): string {\r\n  const cleaned = phone.replace(/\\D/g, '');\r\n  if (cleaned.length === 10) {\r\n    return `(${cleaned.slice(0, 3)}) ${cleaned.slice(3, 6)}-${cleaned.slice(6)}`;\r\n  }\r\n  return phone;\r\n}\r\n"],"mappings":"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","names":["calculateNetTradeValue"]}